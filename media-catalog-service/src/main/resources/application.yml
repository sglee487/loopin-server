server:
  port: 59001
  shutdown: graceful
  netty:
    connection-timeout: 2s
    idle-timeout: 15s

spring:
  application:
    name: media-catalog-service
  cache:
    type: redis
  data:
    redis:
      host: localhost
      port: 56371
      repositories:
        enabled: off
  main:
    allow-bean-definition-overriding: true
  lifecycle:
    timeout-per-shutdown-phase: 15s
  r2dbc:
    username: user
    password: password
    url: r2dbc:postgresql://localhost:5432/loopin_media_catalog
    pool:
      max-create-connection-time: 2s
      initial-size: 5
      max-size: 10
  flyway:
    user: ${spring.r2dbc.username}
    password: ${spring.r2dbc.password}
    url: jdbc:postgresql://localhost:5432/loopin_media_catalog
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:59020/realms/loopin

bucket4j:
  enabled: true
  cache-to-use: redis-lettuce
  filters:
    - id: youtube-sync-per-user
      filter-method: webflux
      filter-order: 330          # Security(-100) ë’¤
      url: /api/v1/playlists/youtube/.*
      http-status-code: TOO_MANY_REQUESTS
      cache-name: buckets
      rate-limits:
        - cache-key: |
            @securityService.username() ?:
            getRemoteAddress()?.address?.hostAddress ?:
            'anonymous'
          num-tokens: 1
          bandwidths:
            - capacity: 5
              time: 1
              unit: days
              refill-speed: interval

logging:
  pattern:
    level: "%5p [${spring.application.name},%X{trace_id},%X{span_id}]"
  level:
    com.giffing.bucket4j: debug

loopin:
  youtube-service-uri: "http://localhost:59011"
#debug: true
