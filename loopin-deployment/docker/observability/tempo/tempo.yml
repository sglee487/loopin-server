#server:
#  http_listen_port: 3200

distributor:
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317   # ★ 꼭 지정
        http:
          endpoint: 0.0.0.0:4318   # (HTTP도 쓴다면)

ingester:
  trace_idle_period: 10s
  max_block_bytes: 1_000_000
  max_block_duration: 5m

compactor:
  compaction:
    compaction_window: 1h
    max_block_bytes: 100_000_000
    block_retention: 1h
    compacted_block_retention: 10m

storage:
  trace:
    backend: local
    local:
      path: /tmp/tempo/blocks

metrics_generator:
  # 필요하면 컬렉션 주기·라벨을 registry 안에 넣음
  registry:
    collection_interval: 15s           # 기본 15 s
    external_labels:
      source: tempo
      cluster: docker-compose

  # 🔑 remote_write 는 storage 아래로 이동
  storage:
    path: /tmp/tempo/generator/wal     # WAL 저장 위치
    remote_write:
      - url: http://prometheus:9090/api/v1/write
        send_exemplars: true           # (선택) 예제용
  traces_storage: # ★ 새로 추가 — local-blocks 가 읽는 WAL
    path: /tmp/tempo/generator/traces-wal

# 프로세서 활성화는 overrides 에서
overrides:
  metrics_generator_processors:
    - service-graphs
    - span-metrics
    - local-blocks